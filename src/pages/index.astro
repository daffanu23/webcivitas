---
import Layout from '../layouts/Layout.astro';
import HeroNews from '../components/HeroNews.astro';
import SubNewsCard from '../components/SubNewsCard.astro'; // Komponen Baru
import { supabase } from '../lib/supabase';

// 1. Fetch Data (1 Hero + 6 Sub News = Limit 7)
const { data: articles, error } = await supabase
  .from('articles')
  .select(`
    id, title, slug, created_at, cover_url, content,
    profiles ( full_name )
  `)
  .eq('status', 'published')
  .order('created_at', { ascending: false })
  .limit(7);

if (error) console.error("Error fetch news:", error);

// 2. Pisahkan Data
const heroArticle = articles && articles.length > 0 ? articles[0] : null;
const subArticles = articles && articles.length > 1 ? articles.slice(1) : [];
---

<Layout title="MEDIACIVITAS - Berita Terkini">

    <div class="section-hero">
        <HeroNews article={heroArticle} />
    </div>

    {subArticles.length > 0 && (
        <div class="section-latest">
            
            <div class="section-header">
                <h2>Terbaru</h2>
                <div class="line"></div>
            </div>

            <div class="news-grid">
                {subArticles.map((item) => (
                    <div class="grid-item">
                        <SubNewsCard article={item} />
                    </div>
                ))}
            </div>
            
            <div class="center-btn">
                <a href="/arsip" class="btn-archive">Lihat Arsip Berita â†’</a>
            </div>

        </div>
    )}

</Layout>

<style>
    /* SECTION SPACING */
    .section-hero {
        margin-top: 20px;
        margin-bottom: 60px;
    }

    .section-latest {
        margin-bottom: 100px; /* Jarak bawah lega agar tidak ketutup Floating Bar */
    }

    /* SECTION HEADER (Garis & Judul) */
    .section-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 40px;
    }
    .section-header h2 {
        font-size: 1.5rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin: 0;
    }
    .line {
        flex-grow: 1;
        height: 2px;
        background-color: #111;
    }

    /* GRID SYSTEM (3 Kolom) */
    .news-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* Default Desktop: 3 Kolom */
        gap: 30px;
        margin-bottom: 60px;
    }

    /* TOMBOL ARSIP */
    .center-btn { text-align: center; }
    .btn-archive {
        display: inline-block;
        padding: 15px 40px;
        background: #111;
        color: #fff;
        font-weight: 700;
        border-radius: 50px;
        transition: transform 0.2s, background 0.2s;
    }
    .btn-archive:hover {
        background: #333;
        transform: scale(1.05);
    }

    /* RESPONSIVE */
    @media (max-width: 900px) {
        .news-grid { grid-template-columns: repeat(2, 1fr); } /* Tablet: 2 Kolom */
    }
    @media (max-width: 600px) {
        .news-grid { grid-template-columns: 1fr; } /* HP: 1 Kolom */
    }
</style>