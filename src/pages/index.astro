---
import FloatingBar from '../components/FloatingBar.astro';
import Footer from '../components/Footer.astro';
import { supabase } from '../lib/supabase';
import '../styles/global.css'; 

// 1. Ambil Data Artikel (Limit 4: 1 Hero + 3 Sub)
const { data: articles, error } = await supabase
  .from('articles')
  .select(`*, profiles ( full_name )`)
  .eq('status', 'published')
  .order('created_at', { ascending: false })
  .limit(4);

if (error) console.error("Error fetch news:", error);

// Pisahkan Berita
const heroArticle = articles && articles.length > 0 ? articles[0] : null;
const subArticles = articles && articles.length > 1 ? articles.slice(1, 4) : [];
---

<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEDIACIVITAS - Independent Journalism</title>
</head>
<body>

    <header class="top-header">
        <div class="container">
            <span class="brand-handle">@mediacivitas</span>
        </div>
    </header>

    <main class="container">
        
        {/* HERO SECTION (HIGHLIGHT) */}
        {heroArticle ? (
            <a href={`/berita/${heroArticle.slug}`} class="hero-wrapper">
                <div class="hero-image-box">
                    <img 
                        src={heroArticle.cover_url || 'https://placehold.co/1200x600'} 
                        alt={heroArticle.title} 
                    />
                </div>
                <div class="hero-content">
                    <div class="hero-meta">
                        <span class="badge">TERBARU</span>
                        <span class="date">{new Date(heroArticle.created_at).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' })}</span>
                    </div>
                    <h1 class="hero-title">{heroArticle.title}</h1>
                    <p class="hero-excerpt">Baca selengkapnya &rarr;</p>
                </div>
            </a>
        ) : (
            <div class="empty-state">
                <h1>Belum ada berita yang diterbitkan.</h1>
            </div>
        )}

        {/* SUB NEWS (TOP 3) */}
        {subArticles.length > 0 && (
            <section class="latest-section">
                <div class="section-header">
                    <h2>Berita Pilihan</h2>
                    <a href="/arsip" class="view-all">Lihat Semua Arsip &rarr;</a>
                </div>

                <div class="news-grid">
                    {subArticles.map((item) => (
                        <a href={`/berita/${item.slug}`} class="news-card">
                            <div class="img-container">
                                <img src={item.cover_url || 'https://placehold.co/600x400'} alt={item.title} />
                            </div>
                            <div class="card-body">
                                <div class="meta-small">
                                    <span>{new Date(item.created_at).toLocaleDateString('id-ID')}</span>
                                    <span>â€¢</span>
                                    <span>{item.profiles?.full_name || 'Redaksi'}</span>
                                </div>
                                <h3 class="card-title-small">{item.title}</h3>
                            </div>
                        </a>
                    ))}
                </div>
            </section>
        )}

    </main>

    <FloatingBar />
    
    <Footer />

</body>
</html>

<style>
    /* HEADER KECIL CLEAN */
    .top-header {
        padding: 20px 0;
        margin-bottom: 20px;
    }
    .brand-handle {
        font-family: 'Poppins', sans-serif;
        font-weight: 300; /* Light weight */
        font-size: 0.9rem;
        letter-spacing: 0.05em;
        color: #111;
    }

    /* HERO SECTION */
    .hero-wrapper {
        display: block;
        text-decoration: none;
        color: inherit;
        margin-bottom: 80px;
        position: relative;
        /* Brutalist Touch: No Radius */
    }
    .hero-image-box {
        width: 100%;
        height: 500px; /* Besar & Dominan */
        overflow: hidden;
        border: 1px solid #000;
        margin-bottom: 25px;
        position: relative;
    }
    .hero-image-box img {
        width: 100%; height: 100%; object-fit: cover;
        transition: transform 0.5s ease;
        filter: grayscale(100%);
    }
    .hero-wrapper:hover .hero-image-box img {
        transform: scale(1.02);
        filter: grayscale(0%);
    }

    .hero-content { max-width: 900px; }
    .hero-meta { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
    
    .badge {
        background: #000; color: #fff;
        padding: 5px 10px; font-weight: 700; font-size: 0.75rem;
        letter-spacing: 1px;
    }
    .date { font-weight: 600; color: #666; font-size: 0.9rem; }

    .hero-title {
        font-size: 3.5rem; /* Judul Besar */
        font-weight: 900;
        line-height: 1.1;
        letter-spacing: -1px;
        margin-bottom: 15px;
        transition: color 0.2s;
    }
    .hero-wrapper:hover .hero-title { text-decoration: underline; }
    
    .hero-excerpt { font-weight: 500; font-size: 1.1rem; }

    /* LATEST SECTION */
    .latest-section { margin-bottom: 100px; }
    .section-header { 
        display: flex; justify-content: space-between; align-items: end; 
        margin-bottom: 30px; border-bottom: 2px solid #000; padding-bottom: 10px; 
    }
    .section-header h2 { font-size: 1.5rem; font-weight: 800; text-transform: uppercase; margin: 0; }
    .view-all { font-weight: 600; font-size: 0.9rem; text-decoration: underline; }

    /* GRID SYSTEM (Sama kayak sebelumnya) */
    .news-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* Pastikan 3 kolom */
        gap: 30px;
    }

    /* MINI CARD */
    .news-card {
        text-decoration: none; color: inherit; display: flex; flex-direction: column;
        border: 1px solid transparent; transition: all 0.2s;
    }
    .news-card:hover { transform: translateY(-5px); }

    .img-container {
        height: 200px; overflow: hidden; border: 1px solid #000; margin-bottom: 15px;
    }
    .img-container img { 
        width: 100%; height: 100%; object-fit: cover; 
        filter: grayscale(100%); transition: filter 0.3s; 
    }
    .news-card:hover img { filter: grayscale(0%); }

    .meta-small { font-size: 0.75rem; font-weight: 700; color: #888; margin-bottom: 8px; display: flex; gap: 5px; }
    .card-title-small { font-size: 1.2rem; font-weight: 700; line-height: 1.4; margin: 0; }

    /* Responsive */
    @media (max-width: 768px) {
        .hero-title { font-size: 2.5rem; }
        .hero-image-box { height: 300px; }
        .news-grid { grid-template-columns: 1fr; }
    }
</style>