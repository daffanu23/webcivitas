---
import Layout from '../layouts/Layout.astro';
import { supabase } from '../lib/supabase';

// Ambil SEMUA berita (Published)
const { data: articles } = await supabase
  .from('articles')
  .select(`*, profiles(full_name)`)
  .eq('status', 'published')
  .order('created_at', { ascending: false });
---

<Layout title="Arsip Berita - MEDIACIVITAS">

    <header class="clean-header">
        <div class="container">
            <span class="brand-text">@mediacivitas / arsip</span>
        </div>
    </header>

    <main class="container">
        
        <div class="page-title-box">
            <h1>SEMUA BERITA</h1>
            <p>Total {articles?.length || 0} artikel diterbitkan.</p>
        </div>

        <div class="news-grid">
            {articles?.map((item) => (
                <a href={`/berita/${item.slug}`} class="news-card">
                    <div class="img-container">
                        <img 
                            src={item.cover_url || 'https://placehold.co/600x400'} 
                            alt={item.title} 
                            loading="lazy" 
                        />
                    </div>
                    <div class="card-body">
                        <div class="meta-small">
                            <span>{new Date(item.created_at).toLocaleDateString('id-ID')}</span>
                            <span>/</span>
                            <span>{item.profiles?.full_name || 'Redaksi'}</span>
                        </div>
                        <h3 class="card-title-small">{item.title}</h3>
                    </div>
                </a>
            ))}
        </div>

    </main>

</Layout>

<style>
    /* HEADER KECIL */
    .clean-header { padding: 30px 0; }
    .brand-text { 
        font-family: 'Poppins', sans-serif; font-weight: 600; font-size: 1rem; 
        /* GANTI: Warna text muted variabel */
        color: var(--text-muted); 
    }

    /* JUDUL ARSIP */
    .page-title-box {
        /* GANTI: Border variabel */
        border-bottom: 2px solid var(--border); 
        margin-bottom: 40px; padding-bottom: 20px;
    }
    .page-title-box h1 { 
        font-size: 3rem; font-weight: 600; letter-spacing: -2px; margin: 0; 
        text-transform: uppercase; line-height: 1; 
        /* GANTI: Warna text utama */
        color: var(--text);
    }
    .page-title-box p { 
        margin: 10px 0 0 0; font-weight: 600; 
        /* GANTI: Warna text muted */
        color: var(--text-muted); 
    }

    /* GRID & CARD STYLE */
    .news-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 30px;
        margin-bottom: 100px;
    }

    .news-card {
        display: flex; flex-direction: column; text-decoration: none; 
        
        /* GANTI: Background & Warna Text Adaptif */
        background: var(--bg-light); 
        color: var(--text);
        
        /* GANTI: Border Variabel */
        border: 1px solid var(--border-muted); 
        
        /* Tambahkan radius agar senada dengan Homepage */
        border-radius: 12px;
        overflow: hidden; 
        
        height: 100%; 
        transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
    }
    
    .news-card:hover {
        transform: translateY(-4px);
        /* GANTI: Border & Shadow saat hover */
        border-color: var(--border); 
        box-shadow: 4px 4px 0px var(--border);
    }

    .img-container {
        height: 200px; 
        /* GANTI: Border pemisah */
        border-bottom: 1px solid var(--border-muted); 
        overflow: hidden;
    }
    .img-container img {
        width: 100%; height: 100%; object-fit: cover;
        filter: grayscale(100%); transition: filter 0.3s, transform 0.3s;
    }
    .news-card:hover img { 
        filter: grayscale(0%); 
        transform: scale(1.05); /* Zoom in dikit biar kece */
    }

    .card-body { padding: 20px; flex: 1; display: flex; flex-direction: column; }
    
    .meta-small { 
        font-size: 0.75rem; font-weight: 600; 
        /* GANTI: Warna text muted */
        color: var(--text-muted); 
        margin-bottom: 10px; text-transform: uppercase; display: flex; gap: 5px; 
    }
    
    .card-title-small { 
        font-size: 1.2rem; font-weight: 700; line-height: 1.3; margin: 0;
        /* GANTI: Warna text utama */
        color: var(--text); 
    }

    /* RESPONSIVE */
    @media (max-width: 600px) {
        .page-title-box h1 { font-size: 2rem; }
    }
</style>