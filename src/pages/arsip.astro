---
import Layout from '../layouts/Layout.astro';
import { supabase } from '../lib/supabase';

// Ambil SEMUA berita (Published)
const { data: articles } = await supabase
  .from('articles')
  .select(`*, profiles(full_name)`)
  .eq('status', 'published')
  .order('created_at', { ascending: false });
---

<Layout title="Arsip Berita - MEDIACIVITAS">

    <header class="clean-header">
        <div class="container">
            <span class="brand-text">@mediacivitas / arsip</span>
        </div>
    </header>

    <main class="container">
        
        <div class="page-title-box">
            <h1>SEMUA BERITA</h1>
            <p>Total {articles?.length || 0} artikel diterbitkan.</p>
        </div>

        <div class="news-grid">
            {articles?.map((item) => (
                <a href={`/berita/${item.slug}`} class="news-card">
                    <div class="img-container">
                        <img 
                            src={item.cover_url || 'https://placehold.co/600x400'} 
                            alt={item.title} 
                            loading="lazy" 
                        />
                    </div>
                    <div class="card-body">
                        <div class="meta-small">
                            <span>{new Date(item.created_at).toLocaleDateString('id-ID')}</span>
                            <span>/</span>
                            <span>{item.profiles?.full_name || 'Redaksi'}</span>
                        </div>
                        <h3 class="card-title-small">{item.title}</h3>
                    </div>
                </a>
            ))}
        </div>

    </main>

</Layout>

<style>
    /* HEADER KECIL */
    .clean-header { padding: 30px 0; }
    .brand-text { font-family: 'Poppins', sans-serif; font-weight: 600; font-size: 1rem; color: #666; }

    /* JUDUL ARSIP */
    .page-title-box {
        border-bottom: 2px solid #111; margin-bottom: 40px; padding-bottom: 20px;
    }
    .page-title-box h1 { font-size: 3rem; font-weight: 900; letter-spacing: -2px; margin: 0; text-transform: uppercase; line-height: 1; }
    .page-title-box p { margin: 10px 0 0 0; font-weight: 600; color: #666; }

    /* GRID & CARD STYLE (Konsisten dengan Homepage) */
    .news-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 30px;
        margin-bottom: 100px; /* Padding bawah lega agar tidak ketutup Navbar Floating */
    }

    .news-card {
        display: flex; flex-direction: column; text-decoration: none; color: inherit;
        border: 1px solid #e5e5e5; background: #fff;
        height: 100%; 
        transition: transform 0.2s, border-color 0.2s;
    }
    .news-card:hover {
        transform: translateY(-4px);
        border-color: #111; /* Efek hover simpel & elegan */
    }

    .img-container {
        height: 200px; border-bottom: 1px solid #e5e5e5; overflow: hidden;
    }
    .img-container img {
        width: 100%; height: 100%; object-fit: cover;
        /* Grayscale effect optional di arsip, kalau mau clean bisa dihapus filter-nya */
        filter: grayscale(100%); transition: filter 0.3s;
    }
    .news-card:hover img { filter: grayscale(0%); }

    .card-body { padding: 20px; flex: 1; display: flex; flex-direction: column; }
    .meta-small { font-size: 0.75rem; font-weight: 700; color: #888; margin-bottom: 10px; text-transform: uppercase; display: flex; gap: 5px; }
    .card-title-small { font-size: 1.2rem; font-weight: 800; line-height: 1.3; margin: 0; }

    /* RESPONSIVE */
    @media (max-width: 600px) {
        .page-title-box h1 { font-size: 2rem; }
    }
</style>