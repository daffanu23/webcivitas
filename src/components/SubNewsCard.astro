---
import { User, Clock } from 'lucide-react';

const { article } = Astro.props;

// --- 1. LOGIC WAKTU (Time Ago) ---
const getRelativeTime = (dateString: string) => {
    if (!dateString) return "";
    const date = new Date(dateString);
    const now = new Date();
    const diffInSeconds = Math.floor((now.getTime() - date.getTime()) / 1000);
    
    const minutes = Math.floor(diffInSeconds / 60);
    const hours = Math.floor(diffInSeconds / 3600);
    const days = Math.floor(diffInSeconds / 86400);

    if (days > 0) return date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
    if (hours > 0) return `${hours} jam lalu`;
    if (minutes > 0) return `${minutes} mnt lalu`;
    return "Baru saja";
};

// --- 2. LOGIC PEMBERSIH HTML (Strip Tags Kuat) ---
const stripHtml = (html: string) => {
   if (!html) return "";
   
   // A. Ganti tag block (<p>, <br>, <div>, </h1>) dengan SPASI agar teks tidak nempel
   let text = html.replace(/<\/?[^>]+(>|$)/g, (match) => {
       // Kalau tag penutup block level, kasih spasi
       if (match.match(/<\/(p|div|h[1-6]|li|tr)>/i) || match.match(/<br\s*\/?>/i)) {
           return ' ';
       }
       return ''; // Tag lain hapus aja
   });
   
   // B. Decode entities sederhana
   text = text.replace(/&nbsp;/g, ' ').replace(/&amp;/g, '&').replace(/&quot;/g, '"');
   
   // C. Hapus spasi berlebih
   return text.replace(/\s+/g, ' ').trim();
};

// Data Dummy Fallback
const data = article || {
    title: "Judul Berita Placeholder",
    slug: "#",
    cover_url: "https://placehold.co/600x400?text=No+Image",
    content: "Konten belum tersedia...",
    created_at: new Date().toISOString(),
    profiles: { full_name: "Redaksi" }
};

// --- 3. PROSES EXCERPT ---
const cleanContent = stripHtml(data.content || "");
// Ambil 100 karakter pertama biar kartu tidak kepanjangan
const excerpt = cleanContent.substring(0, 100) + (cleanContent.length > 100 ? "..." : "");

---

<a href={`/berita/${data.slug}`} class="news-card">
    
    <div class="card-image">
        <img src={data.cover_url} alt={data.title} loading="lazy" />
    </div>

    <div class="card-content">
        <h3 class="card-title">{data.title}</h3>
        
        <p class="card-excerpt">{excerpt}</p>
        
        <div class="card-meta">
            <div class="meta-item author">
                <User size={14} />
                <span>{data.profiles?.full_name || 'Redaksi'}</span>
            </div>
            <div class="meta-item time">
                <Clock size={14} />
                <span>{getRelativeTime(data.created_at)}</span>
            </div>
        </div>
    </div>

</a>

<style>
    .news-card {
        display: flex;
        flex-direction: column;
        background: var(--bg-light); 
        text-decoration: none;
        color: inherit;
        border: 1px solid var(--border);
        border-radius: 12px;
        overflow: hidden;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        height: 100%; /* Pastikan tinggi seragam di Grid */
    }

    /* Efek Hover: Naik & Shadow */
    .news-card:hover {
        transform: translateY(-4px);
        box-shadow: 6px 6px 0px var(--border); /* Shadow Solid Brutalist */
        border-color: var(--text);
    }

    /* AREA GAMBAR */
    .card-image {
        width: 100%;
        height: 180px; /* Tinggi tetap biar rapi */
        border-bottom: 1px solid var(--border);
        overflow: hidden;
        background: var(--bg-light);
    }
    
    .card-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    .news-card:hover .card-image img {
        transform: scale(1.05);
    }

    /* AREA TEKS */
    .card-content {
        padding: 20px;
        display: flex;
        flex-direction: column;
        flex-grow: 1; /* Isi sisa ruang agar footer sejajar */
    }

    .card-title {
        font-size: 1.1rem;
        font-weight: 700;
        line-height: 1.4;
        margin-bottom: 10px;
        color: var(--text);
        
        /* Batasi judul max 2 baris */
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .card-excerpt {
        font-size: 0.9rem;
        color: var(--text-muted);
        margin-bottom: 20px;
        line-height: 1.6;
        
        /* Batasi excerpt max 3 baris */
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .card-meta {
        display: flex;
        align-items: center;
        justify-content: space-between; /* Penulis kiri, Waktu kanan */
        font-size: 0.8rem;
        font-weight: 600;
        color: var(--text-muted);
        padding-top: 15px;
        border-top: 1px dashed var(--border-muted);
        margin-top: auto; /* Dorong ke paling bawah */
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .author { max-width: 60%; }
    .author span { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
</style>