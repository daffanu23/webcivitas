<div id="draft-reminder-container"></div>

<script>
    import { supabase } from '../lib/supabase';
    import { ArrowUpRight } from 'lucide-react'; // Note: Lucide icon di script agak tricky, kita pakai SVG string manual biar aman

    async function checkDrafts() {
        // 1. Cek Login di Browser
        const { data: { session } } = await supabase.auth.getSession();
        
        if (session) {
            // 2. Ambil Draft User
            const { data } = await supabase
                .from('articles')
                .select('title, slug, updated_at, content') 
                .eq('author_id', session.user.id)
                .eq('status', 'draft')
                .order('updated_at', { ascending: false })
                .limit(1)
                .single();
            
            // 3. Render HTML jika ada draft
            if (data) {
                const container = document.getElementById('draft-reminder-container');
                
                // Bersihkan HTML tag untuk preview
                const plainText = data.content ? data.content.replace(/<[^>]+>/g, '') : '';
                const snippet = plainText.substring(0, 100) + (plainText.length > 100 ? '...' : '');

                if (container) {
                    container.innerHTML = `
                        <div class="container draft-wrapper">
                            <div class="draft-card">
                                <div class="draft-content">
                                    <h3 class="draft-title">${data.title || '(Tanpa Judul)'}</h3>
                                    <div class="draft-meta">
                                        <div class="status-indicator"><div class="spinner-ring"></div></div>
                                        <span class="meta-text">Draft - Anda</span>
                                    </div>
                                    <p class="draft-desc">${snippet || "Belum ada isi konten..."}</p>
                                </div>
                                <a href="/redaksi/tulis?slug=${data.slug}" class="btn-resume" aria-label="Lanjut Menulis">
                                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg>
                                </a>
                            </div>
                        </div>
                    `;
                }
            }
        }
    }

    // Jalankan saat load
    checkDrafts();
    document.addEventListener('astro:page-load', checkDrafts);
</script>

<style>
    /* CSS Sama persis seperti sebelumnya */
    .draft-wrapper { margin-top: 20px; margin-bottom: 20px; }
    .draft-card {
        display: flex; justify-content: space-between; align-items: center;
        background: var(--bg-light); border: 1px solid var(--text);
        padding: 24px; border-radius: 16px; gap: 20px; transition: transform 0.2s;
    }
    .draft-content { flex: 1; }
    .draft-title {
        font-family: 'Poppins', sans-serif; font-size: 1.4rem; font-weight: 700; color: var(--text);
        margin: 0 0 10px 0; line-height: 1.2;
    }
    .draft-meta { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
    .status-indicator { position: relative; width: 16px; height: 16px; }
    .spinner-ring {
        width: 100%; height: 100%; border: 2px solid var(--text-muted);
        border-top-color: var(--text); border-radius: 50%; animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .meta-text { font-size: 0.9rem; font-weight: 600; color: var(--text-muted); }
    .draft-desc {
        font-size: 1rem; color: var(--text); line-height: 1.5; margin: 0; opacity: 0.8;
        display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
    }
    .btn-resume {
        display: flex; align-items: center; justify-content: center; width: 60px; height: 60px;
        border: 3px solid var(--text); border-radius: 12px; color: var(--text); transition: all 0.2s; flex-shrink: 0;
    }
    .btn-resume:hover { background: var(--text); color: var(--bg); transform: translate(2px, -2px); }
    @media (max-width: 600px) {
        .draft-card { padding: 20px; } .draft-title { font-size: 1.2rem; } .btn-resume { width: 50px; height: 50px; }
    }
</style>