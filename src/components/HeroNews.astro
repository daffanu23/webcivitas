---
import { User, Clock } from 'lucide-react';

const { article } = Astro.props;

// --- LOGIC WAKTU (Time Ago) ---
const getRelativeTime = (dateString: string) => {
    const date = new Date(dateString);
    const now = new Date();
    const diffInSeconds = Math.floor((now.getTime() - date.getTime()) / 1000);
    
    const minutes = Math.floor(diffInSeconds / 60);
    const hours = Math.floor(diffInSeconds / 3600);
    const days = Math.floor(diffInSeconds / 86400);

    if (days > 0) return date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
    if (hours > 0) return `${hours} jam yang lalu`;
    if (minutes > 0) return `${minutes} menit yang lalu`;
    return "Baru saja";
};

// Fallback Data
const data = article || {
    title: "Menunggu Berita Utama...",
    slug: "#",
    cover_url: "https://placehold.co/1200x600?text=No+Image",
    content: "Belum ada berita yang dipublish. Silakan login sebagai redaksi.",
    created_at: new Date().toISOString(),
    profiles: { full_name: "Redaksi" }
};

// --- LOGIC PEMBERSIH HTML (Strip Tags) ---
// Kita ganti tag HTML dengan SPASI agar kata-kata tidak nempel
// Contoh: <p>Halo</p><p>Dunia</p> -> "Halo Dunia" (Bukan "HaloDunia")
const rawContent = data.content || "";
const plainText = rawContent.replace(/<\/?[^>]+(>|$)/g, " "); 
const excerpt = plainText.trim().substring(0, 200) + (plainText.length > 200 ? "..." : "");

---

<section class="hero-wrapper">
    <div class="hero-card">
        
        <div class="hero-image">
            <img src={data.cover_url} alt={data.title} />
        </div>

        <div class="hero-content">
            
            <h1 class="hero-title">
                <a href={`/berita/${data.slug}`}>{data.title}</a>
            </h1>

            <div class="hero-meta">
                <div class="meta-item">
                    <User size={16} />
                    <span>{data.profiles?.full_name || 'Redaksi'}</span>
                </div>
                <span>â€¢</span>
                <div class="meta-item">
                    <Clock size={16} />
                    <span>{getRelativeTime(data.created_at)}</span>
                </div>
            </div>

            <p class="hero-desc">
                {excerpt}
            </p>

            <a href={`/berita/${data.slug}`} class="btn-read">
                Baca selengkapnya
            </a>

        </div>
    </div>
</section>

<style>
    .hero-wrapper {
        width: 100%;
        margin-bottom: 60px;
    }

    /* KOTAK UTAMA */
    .hero-card {
        display: flex;
        flex-direction: column;
        
        /* Background & Border Variabel */
        background: var(--bg-light); 
        border: 2px solid var(--border);
        color: var(--text);
        border-radius: 10px;
        
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .hero-card:hover {
        transform: translateY(-4px);
        box-shadow: 8px 8px 0px var(--border);
    }

    /* GAMBAR */
    .hero-image {
        width: 100%;
        height: 250px;
        border-bottom: 2px solid var(--border);
        overflow: hidden;
        /* PENTING: Biar gambar ga gepeng/hilang saat teks kepanjangan */
        flex-shrink: 0; 
    }

    .hero-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    .hero-card:hover .hero-image img {
        transform: scale(1.02);
    }

    /* KONTEN TEKS */
    .hero-content {
        padding: 30px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        flex: 1; /* Isi ruang sisa */
        min-width: 0; /* Mencegah flex item overflow */
    }

    .hero-title {
        font-size: 2rem;
        font-weight: 600;
        line-height: 1.1;
        margin-bottom: 15px;
        color: var(--text);
        
        /* Batasi judul max 3 baris biar rapi */
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    .hero-title a { text-decoration: none; color: inherit; }

    .hero-meta {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--text-muted);
        margin-bottom: 20px;
    }
    .meta-item { display: flex; align-items: center; gap: 6px; }

    .hero-desc {
        font-size: 1rem;
        color: var(--text-muted);
        line-height: 1.6;
        margin-bottom: 30px;
        
        /* --- KUNCI PENYELAMAT LAYOUT --- */
        /* Batasi teks max 4 baris, sisanya titik-titik (...) */
        display: -webkit-box;
        -webkit-line-clamp: 4; 
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    /* TOMBOL BACA */
    .btn-read {
        display: inline-block;
        padding: 10px 24px;
        border: 1px solid var(--border);
        border-radius: 50px; /* Saya ubah jadi rounded biar lebih modern dikit */
        color: var(--text);
        
        font-weight: 600;
        text-decoration: none;
        width: fit-content;
        transition: all 0.2s;
    }

    .btn-read:hover {
        background: var(--text);
        color: var(--bg);
        border-color: var(--text);
    }

    /* RESPONSIVE DESKTOP (> 900px) */
    @media (min-width: 900px) {
        .hero-card {
            flex-direction: row;
            min-height: 450px;
            max-height: 500px; /* Batasi tinggi total kartu agar tidak raksasa */
        }
        
        .hero-image {
            /* FIX: Gunakan flex-basis untuk ukuran pasti (55% gambar, 45% teks) */
            flex: 0 0 55%; 
            height: auto; /* Reset height mobile */
            border-bottom: none;
            border-right: 2px solid var(--border);
        }
        
        .hero-content {
            padding: 50px;
        }

        .hero-title { font-size: 2.5rem; }
    }
</style>